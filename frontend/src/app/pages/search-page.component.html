<div class="search-container">
  <!-- ‰ΩøÁî® ngFormÔºåÊñπ‰æøÊãøÂà∞ submitted Áä∂ÊÄÅ -->
  <form
    class="search-form"
    #searchForm="ngForm"
    (ngSubmit)="onSearch(searchForm)"
  >
    <!-- Keywords -->
    <div
      class="form-group keyword-group"
      [ngClass]="{
        'group-error':
          keywordsCtrl.invalid && (keywordsCtrl.touched || searchForm.submitted)
      }"
    >
      <label class="field-label">Keywords <span class="required">*</span></label>
      <div class="keyword-input-wrapper">
        <input
          type="text"
          class="text-input"
          name="keywords"
          placeholder="Search for events..."
          required
          autocomplete="off"
          [(ngModel)]="keywords"
          #keywordsCtrl="ngModel"
          (input)="onKeywordInput($event.target.value)"
          (focus)="onKeywordFocus()"
          (blur)="onKeywordBlur()"
        />
        <!-- Â∞èÁÆ≠Â§¥ÂõæÊ†á -->
        <div class="dropdown-arrow" *ngIf="!isSuggestLoading">
          <span *ngIf="!isSuggestionOpen">‚ñº</span>
          <span *ngIf="isSuggestionOpen">‚ñ≤</span>
        </div>
        <!-- Ê∏ÖÈô§ÊåâÈíÆ -->
        <div
        class="keyword-clear"
        *ngIf="keywords && !isSuggestLoading"
        (click)="clearKeywords()"
        >
        ‚úï
        </div>
        <!-- Êñ∞Â¢û spinner -->
        <div class="keyword-spinner" *ngIf="isSuggestLoading">
          <span class="spinner-icon"></span>
        </div>
      </div>


      <div
        class="error-message"
        *ngIf="
          keywordsCtrl.invalid &&
          (keywordsCtrl.touched || searchForm.submitted)
        "
      >
        Please enter some keywords
      </div>

      <!-- Ticketmaster Suggest Ëá™Âä®Ë°•ÂÖ®‰∏ãÊãâ -->
      <ul
        class="keyword-suggest-list"
        *ngIf="isSuggestionOpen && suggestions?.length"
      >
        <li
          class="keyword-suggest-item"
          *ngFor="let s of suggestions"
          (mousedown)="pickSuggestion(s)"
        >
          {{ s }}
        </li>
      </ul>
    </div>

    <!-- Category -->
    <div class="form-group category-group">
      <label class="field-label">
        Category <span class="required">*</span>
      </label>
      <select class="select-input" name="category" [(ngModel)]="category">
        <option value="all">All</option>
        <option value="music">Music</option>
        <option value="sports">Sports</option>
        <option value="arts">Arts &amp; Theatre</option>
        <option value="film">Film</option>
        <option value="miscellaneous">Miscellaneous</option>
      </select>
    </div>

    <!-- Location + Auto Detect -->
    <div
      class="form-group location-group"
      [ngClass]="{
        'group-error':
          !autoDetectLocation &&
          locationCtrl.invalid &&
          (locationCtrl.touched || searchForm.submitted)
      }"
    >
      <div class="location-header">
        <span class="field-label">Location <span class="required">*</span></span>
        <label class="auto-detect">
          <span>Auto-detect Location</span>
          <input
            type="checkbox"
            class="toggle-checkbox"
            name="autoDetectLocation"
            [(ngModel)]="autoDetectLocation"
            (change)="onAutoDetectChange()"
          />
          <span class="toggle-switch"></span>
        </label>
      </div>

      <input
        type="text"
        class="text-input"
        name="location"
        placeholder="Enter city, district or street..."
        [required]="!autoDetectLocation"
        [disabled]="autoDetectLocation"
        [(ngModel)]="location"
        #locationCtrl="ngModel"
      />

      <!-- ‚ë† ÂéüÊù•ÁöÑÂøÖÂ°´Ê†°È™åÔºöÂè™ÊúâÂú®ÂÖ≥Èó≠Ëá™Âä®ÂÆö‰ΩçÊó∂Êâç‰ºöËß¶Âèë -->
      <div
        class="error-message"
        *ngIf="
          !autoDetectLocation &&
          locationCtrl.invalid &&
          (locationCtrl.touched || searchForm.submitted)
        "
      >
        Location is required when auto-detect is off
      </div>

      <!-- ‚ë° Ëá™Âä®ÂÆö‰ΩçÂ§±Ë¥•ÁöÑÈîôËØØÊèêÁ§∫ÔºàTS ÈáåÁªô locError ËµãÂÄºÂç≥ÂèØÔºâ -->
      <div class="error-message" *ngIf="locError">
        {{ locError }}
      </div>

      <!-- ‚ë¢ Ëá™Âä®ÂÆö‰Ωç‰∏≠ÁöÑÂä†ËΩΩÊèêÁ§∫ -->
      <div class="hint-text" *ngIf="autoDetectLocation && isLocLoading">
        Detecting location...
      </div>
    </div>

    <!-- Distance -->
    <div
      class="form-group distance-group"
      [ngClass]="{
        'group-error':
          distanceCtrl.invalid &&
          (distanceCtrl.dirty || distanceCtrl.touched || searchForm.submitted)
      }"
    >
      <label class="field-label">
        Distance <span class="required">*</span>
      </label>

      <div class="distance-field">
        <input
          type="number"
          class="distance-input"
          name="distance"
          required
          min="0"
          max="100"
          pattern="^[0-9]+$"
          [(ngModel)]="distance"
          #distanceCtrl="ngModel"
        />
        <span class="unit">miles</span>
      </div>

      <!-- ÈîôËØØÊèêÁ§∫ -->
      <div
        class="error-message"
        *ngIf="
          distanceCtrl.invalid &&
          (distanceCtrl.dirty || distanceCtrl.touched || searchForm.submitted)
        "
      >
        <!-- ÊÉÖÂÜµ 1 & 2Ôºö‰∏∫Á©∫ / ÈùûÊï∞Â≠ó -->
        <span
          *ngIf="distanceCtrl.errors?.required || distanceCtrl.errors?.pattern"
        >
          Distance must be a number
        </span>

        <!-- ÊÉÖÂÜµ 3ÔºöË∂ÖËøá 100 -->
        <span *ngIf="distanceCtrl.errors?.max">
          Distance cannot exceed 100
        </span>
      </div>
    </div>

    <!-- Search Button -->
    <div class="button-group">
      <button type="submit" class="search-button">
        <span class="icon">üîç</span>
        <span>Search Events</span>
      </button>
    </div>
  </form>
</div>

<!-- HintÔºöÂè™ÊúâÂú®ËøòÊ≤°Êúâ‰ªª‰ΩïÁªìÊûú„ÄÅ‰πüÊ≤°Êúâ‚ÄúÊó†ÁªìÊûú‚ÄùÊèêÁ§∫Êó∂ÊâçÊòæÁ§∫ -->
<div class="search-hint" *ngIf="events.length === 0 && !noResults">
  <div class="hint-icon">üîç</div>
  <div class="hint-text">
    Enter search criteria and click the Search button to find events.
  </div>
</div>

<!-- ÁªìÊûúÂàóË°®Âå∫Âüü -->
<div class="results-container" *ngIf="events.length > 0">
  <div
    class="event-card"
    *ngFor="let ev of events"
    (click)="goToDetail(ev.id)"
  >
    <!-- ÂõæÁâá + Â∑¶‰∏äÁ±ªÂà´ + Âè≥‰∏äÊó∂Èó¥ -->
    <div class="event-image-wrapper">
      <img class="event-image" [src]="ev.imageUrl" [alt]="ev.name" />

      <!-- Â∑¶‰∏äÔºöÁ±ªÂà´ÔºåÂè™Âú®ËØÜÂà´Âà∞ 5 Áßç‰πã‰∏ÄÊó∂ÊòæÁ§∫ -->
      <div class="event-category-pill" *ngIf="getCategoryLabel(ev) as cat">
        {{ cat }}
      </div>

      <!-- Âè≥‰∏äÔºöÊó∂Èó¥ÔºåÊ≤°ÊúâÂ∞±‰∏çÊòæÁ§∫ -->
      <div class="event-date-pill" *ngIf="getDateTimeLabel(ev) as dt">
        {{ dt }}
      </div>
    </div>

    <!-- Âç°Áâá‰∏ãÂçäÈÉ®ÂàÜÔºöÊ†áÈ¢ò + Âú∫È¶Ü + Êî∂Ëóè -->
    <div class="event-info">
      <!-- Â∑¶ËæπÔºöÊ†áÈ¢ò + Âú∫È¶Ü -->
      <div class="event-main">
        <div class="event-name">
          {{ ev.name }}
        </div>

        <div class="event-venue">
          {{ ev.venue }}
        </div>
      </div>

      <!-- Âè≥ËæπÔºöÁà±ÂøÉÊî∂Ëóè -->
      <button
        class="favorite-btn"
        type="button"
        (click)="toggleFavorite(ev, $event)"
      >
        <span
          class="heart-icon"
          [class.heart-filled]="isFavorite(ev)"
        >
          ‚ô•
        </span>
      </button>
    </div>
  </div>
</div>

<div class="no-results" *ngIf="noResults">
  No events found.
</div>
